# golangci-lint version: 1.44.2

run:
  # default concurrency is an available CPU number, you can adjust accordingly.
  concurrency: 8 # 4

  # timeout for analysis, e.g. 30s, 5m, default is 1m
  timeout: 3m

  # exit code when at least one issue was found, default is 1
  issues-exit-code: 1

  # include test files or not, default is true
  tests: false

  # which dirs to skip: issues from them won't be reported;
  # can use regexp here: generated.*, regexp is applied on full path;
  # default value is empty list, but default dirs are skipped independently
  # from this option's value (see skip-dirs-use-default).
  # "/" will be replaced by current OS file path separator to properly work
  # on Windows.
  skip-dirs:
    - docker
    - vendor
    - docs

  # default is true. Enables skipping of directories:
  #   vendor$, third_party$, testdata$, examples$, Godeps$, builtin$
  skip-dirs-use-default: true

  # which files to skip: they will be analyzed, but issues from them
  # won't be reported. Default value is empty list, but there is
  # no need to include all autogenerated files, we confidently recognize
  # autogenerated files. If it's not please let us know.
  # "/" will be replaced by current OS file path separator to properly work
  # on Windows.
  skip-files:
    - ".*\\.my\\.go$"

issues:
  ## only report issues since below revision.
  #new-from-rev: {commit sha}

  exclude-rules:
    # Exclude `lll` issues for long lines with comment `//`.
    - linters:
        - lll
      source: "// "
    # Exclude crypto usage check.
    - linters:
        - gosec
      text: "weak cryptographic primitive"

linters:
  enable:
    - bodyclose
    - deadcode
    - dupl
    - durationcheck
    - errcheck
    - govet
    - gosec
    - gocritic
    - goimports
    - gofmt
    - gochecknoinits
    - ineffassign
    - lll
    - nolintlint
    - revive # replacement of go-lint
    - staticcheck
    - structcheck
    - typecheck
    - unconvert
    - whitespace

linters-settings:
  lll:
    # Max line length, lines longer will be reported.
    # '\t' is counted as 1 character by default, and can be changed with the tab-width option.
    # Default: 120.
    line-length: 150
    # Tab width in spaces.
    # Default: 1
    tab-width: 1

  errcheck:
    # report about not checking of errors in type assertions: `a := b.(MyStruct)`;
    # default is false: such cases aren't reported by default.
    check-type-assertions: true

  gocritic:
    # Enable multiple checks by tags, run `GL_DEBUG=gocritic golangci-lint run` to see all tags and checks.
    # Empty list by default. See https://github.com/go-critic/go-critic#usage -> section "Tags".
    enabled-tags:
      - diagnostic
      - experimental
      - opinionated
      - performance
      - style

  govet:
    # Enable analyzers by name.
    # Run `go tool vet help` to see all analyzers.
    enable:
      - assign
      - atomic
      - bools
      - composites
      - copylocks
      - httpresponse
      - loopclosure
      - lostcancel
      - nilfunc
      - nilness
      - printf
      - shadow # see https://swsmile.info/post/golang-shadowed-variables/ for example
      - shift
      - sortslice
      - stdmethods
      - stringintconv
      - structtag
      - unmarshal
      - unreachable
      - unsafeptr
      - unusedresult

  nolintlint:
    # Enable to require an explanation of nonzero length after each nolint directive. Default is false.
    require-explanation: true
    # Enable to require nolint directives to mention the specific linter being suppressed. Default is false.
    require-specific: true

  revive:
    # See https://github.com/mgechev/revive#configuration
    # Default: warning
    severity: warning
    # This means that linting errors with less than 0.8 confidence will be ignored.
    # Default: 0.8
    confidence: 0.8
    enable-all-rules: true

    rules:
      - name: var-naming
        arguments: [ [ "ID", "UID", "PID", "URL", "DD" ], [ ] ] # allow and deny list
      - name: function-length
        arguments: [ 120, 0 ] # unlimited lines but 120 statements.
      - name: cognitive-complexity
        arguments: [ 25 ] # see https://www.sonarsource.com/docs/CognitiveComplexity.pdf for explanation.
      - name: cyclomatic
        arguments: [ 25 ] # see https://en.wikipedia.org/wiki/Cyclomatic_complexity for explanation.
      - name: function-result-limit
        arguments: [ 3 ] # max return result limit.
      - name: argument-limit
        arguments: [ 8 ]
      - name: add-constant
        arguments:
          - maxLitCount: "9999" # not check string constant
            allowInts: "0,1,10,32,50,64,100,200,250,500,1000,2000,2500,5000,10000"
            allowFloats: "0.0,0.,1.0,1."
      - name: max-public-structs
        disabled: true
      - name: file-header
        disabled: true
      - name: banned-characters
        disabled: true
      - name: blank-imports
        disabled: true
      - name: get-return
        disabled: true
      - name: line-length-limit # use lll instead
        disabled: true
      - name: bare-return
        disabled: true
